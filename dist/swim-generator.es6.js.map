{"version":3,"file":"swim-generator.es6.js","sources":["../lib/data/patterns.json","../lib/getThingViaTimeLimit.js","../lib/data/swims.json","../lib/repeatIntervals.js","../lib/createPattern.js","../lib/index.js"],"sourcesContent":["[\n  {\n    \"repeat\": true,\n    \"minTime\": 0,\n    \"name\": \"repeating intervals\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [4,1] },\n      { \"group\": \"b\", \"interval\": [2,2] },\n      { \"group\": \"c\", \"interval\": [1,4] },\n      { \"group\": \"b\", \"interval\": [2,2] },\n      { \"group\": \"a\", \"interval\": [4,1] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 400,\n    \"intervalSize\": 4,\n    \"name\": \"pyramid\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [4,1] },\n      { \"group\": \"b\", \"interval\": [2,2] },\n      { \"group\": \"a\", \"interval\": [4,1] },\n      { \"group\": \"c\", \"interval\": [1,4] },\n      { \"group\": \"a\", \"interval\": [4,1] },\n      { \"group\": \"b\", \"interval\": [2,2] },\n      { \"group\": \"a\", \"interval\": [4,1] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 560,\n    \"intervalSize\": 4,\n    \"name\": \"200 binary\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [3,2] },\n      { \"group\": \"b\", \"interval\": [2,3] },\n      { \"group\": \"a\", \"interval\": [3,2] },\n      { \"group\": \"c\", \"interval\": [1,6] },\n      { \"group\": \"a\", \"interval\": [3,2] },\n      { \"group\": \"b\", \"interval\": [2,3] },\n      { \"group\": \"a\", \"interval\": [3,2] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 840,\n    \"intervalSize\": 6,\n    \"name\": \"300 binary\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [2,4] },\n      { \"group\": \"a\", \"interval\": [2,3] },\n      { \"group\": \"a\", \"interval\": [2,2] },\n      { \"group\": \"a\", \"interval\": [2,1] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 400,\n    \"intervalSize\": 5,\n    \"name\": \"decline\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [4,4] },\n      { \"group\": \"b\", \"interval\": [4,4] },\n      { \"group\": \"a\", \"interval\": [4,4] },\n      { \"group\": \"b\", \"interval\": [4,4] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 1600,\n    \"intervalSize\": 8,\n    \"name\": \"4x4\"\n  },\n  {\n    \"pattern\": [\n      { \"group\": \"a\", \"interval\": [10,4] }\n    ],\n    \"repeat\": false,\n    \"minTime\": 1000,\n    \"intervalSize\": 40,\n    \"name\": \"10x100\"\n  }\n]\n","import _ from 'lodash';\n\nexport function getThingViaTimeLimit(key, secondsLeft, things, number = 1) {\n  let filteredThings = _.filter(things, thing => (thing[key] * number) <= secondsLeft);\n  return _.sample(filteredThings);\n}\n","[\n  {\n    \"name\": \"HUHO\",\n    \"interval\": 1,\n    \"time\": 25\n  },\n  {\n    \"name\": \"HOHU\",\n    \"interval\": 1,\n    \"time\": 25\n  },\n  {\n    \"name\": \"FU\",\n    \"interval\": 1,\n    \"time\": 30\n  },\n  {\n    \"name\": \"BOGDAT\",\n    \"interval\": 1,\n    \"time\": 30\n  },\n  {\n    \"name\": \"Swim\",\n    \"interval\": 1,\n    \"time\": 20\n  },\n  {\n    \"name\": \"Kick\",\n    \"interval\": 2,\n    \"time\": 45\n  },\n  {\n    \"name\": \"OU\",\n    \"interval\": 2,\n    \"time\": 50\n  },\n  {\n    \"name\": \"UO\",\n    \"interval\": 2,\n    \"time\": 50\n  },\n  {\n    \"name\": \"OUO\",\n    \"interval\": 3,\n    \"time\": 70\n  },\n  {\n    \"name\": \"UOU\",\n    \"interval\": 3,\n    \"time\": 75\n  },\n  {\n    \"name\": \"TOFU\",\n    \"interval\": 4,\n    \"time\": 100\n  }\n]\n","import _ from 'lodash';\nimport {getThingViaTimeLimit} from './getThingViaTimeLimit';\nimport swims from './data/swims.json';\n\nexport function repeatIntervals(secondsLeft, generatedPattern) {\n  if (secondsLeft < 20) {\n    console.log(`weird amount of time left: ${secondsLeft}. returning original pattern`);\n    return generatedPattern;\n  }\n\n  console.log('repeatIntervals');\n\n  let seconds = 0;\n  let selectedSwim = getThingViaTimeLimit(\"time\", secondsLeft, swims);\n\n  console.log(`repeating interval of type ${selectedSwim.name}`)\n\n  while (seconds + selectedSwim.time <= secondsLeft) {\n    let timeLeft = secondsLeft - seconds;\n    let maxRepetition = Math.floor(timeLeft / selectedSwim.time);\n\n    // attempt to keep max length 200 or less\n    maxRepetition = (maxRepetition * selectedSwim.interval) > 8 ?\n      Math.floor(8 / selectedSwim.interval) :\n      maxRepetition;\n\n    let intervalLength = _.random(1, maxRepetition);\n    let secondsToAdd = selectedSwim.time * intervalLength;\n\n    console.log('adding swim', selectedSwim);\n\n    seconds += secondsToAdd;\n    generatedPattern.seconds += secondsToAdd;\n    generatedPattern.intervals.push(\n      {\n        type: selectedSwim.name,\n        length: selectedSwim.interval * 25 * intervalLength,\n        number: 1,\n        time: secondsToAdd\n      }\n    );\n  }\n\n  return generatedPattern;\n}\n","import _ from 'lodash';\nimport swims from './data/swims.json';\n\nfunction getSwimByLength(secondsLeft, intervalLength, number) {\n  if (secondsLeft < 20 * number) {\n    console.log(`weird amount of time left: ${secondsLeft}. returning null`);\n    return null;\n  }\n\n  let selectSwim;\n  let numThings = 0;\n\n  let filteredSwims = _.cloneDeep(swims);\n\n  while (!selectSwim) {\n    numThings++;\n    selectSwim = _.sample(filteredSwims);\n\n    if ((selectSwim.time * number) > secondsLeft) {\n      console.log(`swim too long ${selectSwim.time} ${number} ${secondsLeft}`);\n      filteredSwims = _.filter(filteredSwims, swim => swim.time < selectSwim.time);\n      selectSwim = null;\n    } else if ((selectSwim.interval > intervalLength) || (intervalLength % selectSwim.interval !== 0)) {\n      console.log(`interval too long ${selectSwim.interval} ${intervalLength}`);\n      filteredSwims = _.filter(filteredSwims, swim => swim.interval < selectSwim.interval);\n      selectSwim = null;\n    }\n\n    if (numThings > 20) {throw new Error(`fuck ${secondsLeft} ${intervalLength} ${number}`);}\n  }\n\n  return selectSwim;\n}\n\nfunction createSwimGroupCount(selectedPattern) {\n  return _.reduce(selectedPattern.pattern, (result, set) => {\n    let swimLength = set.interval[1];\n\n    if(!result[set.group]) {\n      result[set.group] = { number: 1, intervalLength: swimLength}\n    } else {\n      result[set.group].number += 1;\n      result[set.group].intervalLength = _.min([result[set.group].intervalLength, swimLength]);\n    }\n\n    return result;\n  }, {});\n}\n\nfunction mapSwimGroupsToSwims(secondsLeft, selectedPattern, groupsWithCount) {\n  let groupsWithSwim = {};\n\n  let sets = selectedPattern.pattern.length;\n\n  // Find a swim which will fit the pattern and the time remaining\n  _.forEach(groupsWithCount, (groupSize, key) => {\n    let intervalSize = selectedPattern.intervalSize;\n    let otherSetTimes = (sets - groupSize.number) * intervalSize * 20;\n    let selectedSwim = getSwimByLength(\n      secondsLeft - otherSetTimes,\n      groupSize.intervalLength,\n      groupSize.number * intervalSize\n    );\n\n    groupsWithSwim[key] = selectedSwim;\n  });\n\n  return groupsWithSwim;\n}\n\nexport function createSwimsFromPattern(secondsLeft, generatedPattern, selectedPattern) {\n  if (secondsLeft < 20) {\n    console.log(`weird amount of time left: ${secondsLeft}. returning original pattern`);\n    return generatedPattern;\n  }\n\n  let groupsWithCount = createSwimGroupCount(selectedPattern);\n  let groupsWithSwim = mapSwimGroupsToSwims(secondsLeft, selectedPattern, groupsWithCount);\n\n  // once we've figured out which swims go where, generate the intervals\n  _.forEach(selectedPattern.pattern, pattern => {\n    let selectedSwim = groupsWithSwim[pattern.group];\n    let numIntervals = pattern.interval[0];\n    let swimLength = pattern.interval[1];\n\n    // Some swims are > 1 lap\n    let intervalMultiplier = swimLength / selectedSwim.interval;\n    let totalSwimTime = selectedSwim.time * numIntervals * (intervalMultiplier);\n\n    generatedPattern.seconds += totalSwimTime;\n    generatedPattern.intervals.push(\n      {\n        type: selectedSwim.name,\n        length: swimLength * 25,\n        number: numIntervals,\n        time: selectedSwim.time * intervalMultiplier\n      }\n    );\n  });\n\n  return generatedPattern;\n}\n","import _ from 'lodash';\nimport patterns from './data/patterns.json';\nimport {getThingViaTimeLimit} from './getThingViaTimeLimit';\nimport {repeatIntervals} from './repeatIntervals';\nimport {createSwimsFromPattern} from './createPattern';\n\nfunction doubleLengths(pattern) {\n  console.log('doubleLengths');\n\n  pattern.seconds *= 2;\n\n  _.forEach(pattern.intervals, interval => {\n    interval.length *= 2;\n    interval.time *= 2;\n  });\n}\n\nfunction doubleIntervals(pattern) {\n  console.log('doubleIntervals');\n  pattern.seconds *= 2;\n\n  _.forEach(pattern.intervals, interval => {\n    interval.number *= 2;\n  });\n}\n\nexport function generatePattern(seconds, generatedPattern = { seconds: 0, intervals: [] }) {\n  if (seconds < 20) {\n    console.log(`weird amount of time left: ${seconds}. returning generated pattern`);\n    return generatedPattern;\n  }\n\n  console.log('generatePattern');\n\n  let timeLeft = seconds - generatedPattern.seconds;\n  let selectedPattern = getThingViaTimeLimit(\"minTime\", timeLeft, patterns);\n\n  console.log(`attempting to generate ${selectedPattern.name} pattern, which needs ${selectedPattern.minTime}, and has ${timeLeft}`)\n\n  if (selectedPattern.repeat === true) {\n    return repeatIntervals(timeLeft, generatedPattern);\n  } else {\n    return createSwimsFromPattern(timeLeft, generatedPattern, selectedPattern);\n  }\n}\n\nexport function generateWorkout(seconds) {\n  if (!seconds) { throw new Error('Give me time!'); }\n\n  let pattern = generatePattern(seconds);\n\n  while ((pattern.seconds < (seconds / 2)) && (pattern.seconds > 20)) {\n    switch(_.random(1,3)) {\n      case 1:\n        doubleLengths(pattern);\n        break;\n      case 2:\n        doubleIntervals(pattern);\n        break;\n      case 3:\n        // add new workout to pattern\n        generatePattern(seconds, pattern);\n        break;\n    }\n  }\n\n  console.log(pattern);\n\n  while (seconds - pattern.seconds > 20) {\n    generatePattern(seconds, pattern);\n  }\n\n  console.log(pattern);\n\n  return pattern;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACEO,SAAS,oBAAT,CAA8B,GAA9B,EAAmC,WAAnC,EAAgD,MAAhD,EAAoE;MAAZ,+DAAS,iBAAG;;MACrE,iBAAiB,EAAE,MAAF,CAAS,MAAT,EAAiB;WAAS,KAAC,CAAM,GAAN,IAAa,MAAb,IAAwB,WAAzB;GAAT,CAAlC,CADqE;SAElE,EAAE,MAAF,CAAS,cAAT,CAAP,CAFyE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEEpE,SAAS,eAAT,CAAyB,WAAzB,EAAsC,gBAAtC,EAAwD;MACzD,cAAc,EAAd,EAAkB;YACZ,GAAR,iCAA0C,4CAA1C,EADoB;WAEb,gBAAP,CAFoB;GAAtB;;UAKQ,GAAR,CAAY,iBAAZ,EAN6D;;MAQzD,UAAU,CAAV,CARyD;MASzD,eAAe,qBAAqB,MAArB,EAA6B,WAA7B,EAA0C,KAA1C,CAAf,CATyD;;UAWrD,GAAR,iCAA0C,aAAa,IAAb,CAA1C,CAX6D;;SAatD,UAAU,aAAa,IAAb,IAAqB,WAA/B,EAA4C;QAC7C,WAAW,cAAc,OAAd,CADkC;QAE7C,gBAAgB,KAAK,KAAL,CAAW,WAAW,aAAa,IAAb,CAAtC;;;iBAGJ,GAAgB,aAAC,GAAgB,aAAa,QAAb,GAAyB,CAA1C,GACd,KAAK,KAAL,CAAW,IAAI,aAAa,QAAb,CADD,GAEd,aAFc,CALiC;;QAS7C,iBAAiB,EAAE,MAAF,CAAS,CAAT,EAAY,aAAZ,CAAjB,CAT6C;QAU7C,eAAe,aAAa,IAAb,GAAoB,cAApB,CAV8B;;YAYzC,GAAR,CAAY,aAAZ,EAA2B,YAA3B,EAZiD;;eActC,YAAX,CAdiD;qBAehC,OAAjB,IAA4B,YAA5B,CAfiD;qBAgBhC,SAAjB,CAA2B,IAA3B,CACE;YACQ,aAAa,IAAb;cACE,aAAa,QAAb,GAAwB,EAAxB,GAA6B,cAA7B;cACA,CAAR;YACM,YAAN;KALJ,EAhBiD;GAAnD;;SA0BO,gBAAP,CAvC6D;;;ACD/D,SAAS,eAAT,CAAyB,WAAzB,EAAsC,cAAtC,EAAsD,MAAtD,EAA8D;MACxD,cAAc,KAAK,MAAL,EAAa;YACrB,GAAR,iCAA0C,gCAA1C,EAD6B;WAEtB,IAAP,CAF6B;GAA/B;;MAKI,mBAAJ,CAN4D;MAOxD,YAAY,CAAZ,CAPwD;;MASxD,gBAAgB,EAAE,SAAF,CAAY,KAAZ,CAAhB,CATwD;;SAWrD,CAAC,UAAD,EAAa;gBAAA;iBAEL,EAAE,MAAF,CAAS,aAAT,CAAb,CAFkB;;QAId,UAAC,CAAW,IAAX,GAAkB,MAAlB,GAA4B,WAA7B,EAA0C;cACpC,GAAR,oBAA6B,WAAW,IAAX,SAAmB,eAAU,WAA1D,EAD4C;sBAE5B,EAAE,MAAF,CAAS,aAAT,EAAwB;eAAQ,KAAK,IAAL,GAAY,WAAW,IAAX;OAApB,CAAxC,CAF4C;mBAG/B,IAAb,CAH4C;KAA9C,MAIO,IAAI,UAAC,CAAW,QAAX,GAAsB,cAAtB,IAA0C,iBAAiB,WAAW,QAAX,KAAwB,CAAzC,EAA6C;cACzF,GAAR,wBAAiC,WAAW,QAAX,SAAuB,cAAxD,EADiG;sBAEjF,EAAE,MAAF,CAAS,aAAT,EAAwB;eAAQ,KAAK,QAAL,GAAgB,WAAW,QAAX;OAAxB,CAAxC,CAFiG;mBAGpF,IAAb,CAHiG;KAA5F;;QAMH,YAAY,EAAZ,EAAgB;YAAO,IAAI,KAAJ,WAAkB,oBAAe,uBAAkB,MAAnD,CAAN,CAAD;KAApB;GAdF;;SAiBO,UAAP,CA5B4D;CAA9D;;AA+BA,SAAS,oBAAT,CAA8B,eAA9B,EAA+C;SACtC,EAAE,MAAF,CAAS,gBAAgB,OAAhB,EAAyB,UAAC,MAAD,EAAS,GAAT,EAAiB;QACpD,aAAa,IAAI,QAAJ,CAAa,CAAb,CAAb,CADoD;;QAGrD,CAAC,OAAO,IAAI,KAAJ,CAAR,EAAoB;aACd,IAAI,KAAJ,CAAP,GAAoB,EAAE,QAAQ,CAAR,EAAW,gBAAgB,UAAhB,EAAjC,CADqB;KAAvB,MAEO;aACE,IAAI,KAAJ,CAAP,CAAkB,MAAlB,IAA4B,CAA5B,CADK;aAEE,IAAI,KAAJ,CAAP,CAAkB,cAAlB,GAAmC,EAAE,GAAF,CAAM,CAAC,OAAO,IAAI,KAAJ,CAAP,CAAkB,cAAlB,EAAkC,UAAnC,CAAN,CAAnC,CAFK;KAFP;;WAOO,MAAP,CAVwD;GAAjB,EAWtC,EAXI,CAAP,CAD6C;CAA/C;;AAeA,SAAS,oBAAT,CAA8B,WAA9B,EAA2C,eAA3C,EAA4D,eAA5D,EAA6E;MACvE,iBAAiB,EAAjB,CADuE;;MAGvE,OAAO,gBAAgB,OAAhB,CAAwB,MAAxB;;;GAGX,CAAE,OAAF,CAAU,eAAV,EAA2B,UAAC,SAAD,EAAY,GAAZ,EAAoB;QACzC,eAAe,gBAAgB,YAAhB,CAD0B;QAEzC,gBAAgB,CAAC,OAAO,UAAU,MAAV,CAAR,GAA4B,YAA5B,GAA2C,EAA3C,CAFyB;QAGzC,eAAe,gBACjB,cAAc,aAAd,EACA,UAAU,cAAV,EACA,UAAU,MAAV,GAAmB,YAAnB,CAHE,CAHyC;;mBAS9B,GAAf,IAAsB,YAAtB,CAT6C;GAApB,CAA3B,CAN2E;;SAkBpE,cAAP,CAlB2E;CAA7E;;AAqBA,AAAO,SAAS,sBAAT,CAAgC,WAAhC,EAA6C,gBAA7C,EAA+D,eAA/D,EAAgF;MACjF,cAAc,EAAd,EAAkB;YACZ,GAAR,iCAA0C,4CAA1C,EADoB;WAEb,gBAAP,CAFoB;GAAtB;;MAKI,kBAAkB,qBAAqB,eAArB,CAAlB,CANiF;MAOjF,iBAAiB,qBAAqB,WAArB,EAAkC,eAAlC,EAAmD,eAAnD,CAAjB;;;GAGJ,CAAE,OAAF,CAAU,gBAAgB,OAAhB,EAAyB,mBAAW;QACxC,eAAe,eAAe,QAAQ,KAAR,CAA9B,CADwC;QAExC,eAAe,QAAQ,QAAR,CAAiB,CAAjB,CAAf,CAFwC;QAGxC,aAAa,QAAQ,QAAR,CAAiB,CAAjB,CAAb;;;QAGA,qBAAqB,aAAa,aAAa,QAAb,CANM;QAOxC,gBAAgB,aAAa,IAAb,GAAoB,YAApB,GAAoC,kBAApC,CAPwB;;qBAS3B,OAAjB,IAA4B,aAA5B,CAT4C;qBAU3B,SAAjB,CAA2B,IAA3B,CACE;YACQ,aAAa,IAAb;cACE,aAAa,EAAb;cACA,YAAR;YACM,aAAa,IAAb,GAAoB,kBAApB;KALV,EAV4C;GAAX,CAAnC,CAVqF;;SA8B9E,gBAAP,CA9BqF;;;AChEvF,SAAS,aAAT,CAAuB,OAAvB,EAAgC;UACtB,GAAR,CAAY,eAAZ,EAD8B;;UAGtB,OAAR,IAAmB,CAAnB,CAH8B;;IAK5B,OAAF,CAAU,QAAQ,SAAR,EAAmB,oBAAY;aAC9B,MAAT,IAAmB,CAAnB,CADuC;aAE9B,IAAT,IAAiB,CAAjB,CAFuC;GAAZ,CAA7B,CAL8B;CAAhC;;AAWA,SAAS,eAAT,CAAyB,OAAzB,EAAkC;UACxB,GAAR,CAAY,iBAAZ,EADgC;UAExB,OAAR,IAAmB,CAAnB,CAFgC;;IAI9B,OAAF,CAAU,QAAQ,SAAR,EAAmB,oBAAY;aAC9B,MAAT,IAAmB,CAAnB,CADuC;GAAZ,CAA7B,CAJgC;CAAlC;;AASA,AAAO,SAAS,eAAT,CAAyB,OAAzB,EAAoF;MAAlD,yEAAmB,EAAE,SAAS,CAAT,EAAY,WAAW,EAAX,kBAAiB;;MACrF,UAAU,EAAV,EAAc;YACR,GAAR,iCAA0C,yCAA1C,EADgB;WAET,gBAAP,CAFgB;GAAlB;;UAKQ,GAAR,CAAY,iBAAZ,EANyF;;MAQrF,WAAW,UAAU,iBAAiB,OAAjB,CARgE;MASrF,kBAAkB,qBAAqB,SAArB,EAAgC,QAAhC,EAA0C,QAA1C,CAAlB,CATqF;;UAWjF,GAAR,6BAAsC,gBAAgB,IAAhB,8BAA6C,gBAAgB,OAAhB,kBAAoC,QAAvH,EAXyF;;MAarF,gBAAgB,MAAhB,KAA2B,IAA3B,EAAiC;WAC5B,gBAAgB,QAAhB,EAA0B,gBAA1B,CAAP,CADmC;GAArC,MAEO;WACE,uBAAuB,QAAvB,EAAiC,gBAAjC,EAAmD,eAAnD,CAAP,CADK;GAFP;CAbK;;AAoBP,AAAO,SAAS,eAAT,CAAyB,OAAzB,EAAkC;MACnC,CAAC,OAAD,EAAU;UAAQ,IAAI,KAAJ,CAAU,eAAV,CAAN,CAAF;GAAd;;MAEI,UAAU,gBAAgB,OAAhB,CAAV,CAHmC;;SAKhC,OAAC,CAAQ,OAAR,GAAmB,UAAU,CAAV,IAAkB,QAAQ,OAAR,GAAkB,EAAlB,EAAuB;YAC3D,EAAE,MAAF,CAAS,CAAT,EAAW,CAAX,CAAP;WACO,CAAL;sBACgB,OAAd,EADF;cAAA;WAGK,CAAL;wBACkB,OAAhB,EADF;cAAA;WAGK,CAAL;;wBAEkB,OAAhB,EAAyB,OAAzB,EAFF;cAAA;KARgE;GAApE;;UAeQ,GAAR,CAAY,OAAZ,EApBuC;;SAsBhC,UAAU,QAAQ,OAAR,GAAkB,EAA5B,EAAgC;oBACrB,OAAhB,EAAyB,OAAzB,EADqC;GAAvC;;UAIQ,GAAR,CAAY,OAAZ,EA1BuC;;SA4BhC,OAAP,CA5BuC;;;"}