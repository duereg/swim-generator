{"version":3,"file":"swim-generator.es6.js","sources":["../lib/data/warmups.js","../lib/data/cooldowns.js","../lib/data/mainSets/ENDURANCE_BASE.js","../lib/data/mainSets/THRESHOLD_SUSTAINED.js","../lib/data/mainSets/THRESHOLD_DEVELOPMENT.js","../lib/data/mainSets/SPEED_ENDURANCE.js","../lib/data/mainSets/MAX_SPRINT.js","../lib/data/mainSets/GENERAL_ENDURANCE.js","../lib/data/mainSets.js","../lib/workoutComponents.js","../lib/css.js","../lib/getThingViaTimeLimit.js","../lib/repeatIntervals.js","../lib/createPattern.js","../lib/index.js"],"sourcesContent":["// Warmup options based on various sources [2, 5, 7, 8, 11, 13, 15, 17, 19, 20]\nconst warmups = [\n    { desc: \"200 no fins, 200 w fins swim\", dist: 400, type: \"swim\" }, //[2]\n    { desc: \"400 warmup (75 kick, 25 under)\", dist: 400, type: \"kick\" }, //[5]\n    { desc: \"250 pull warmup, 250 swim warmup\", dist: 500, type: \"pull/swim\" }, //[20]\n    { desc: \"250 warmup\", dist: 250, type: \"general\" }, //[8, 13]\n    { desc: \"200 warm up\", dist: 200, type: \"general\" }, //[7]\n    { desc: \"500 warmup\", dist: 500, type: \"general\" }, //[11, 17]\n    { desc: \"300 warm up\", dist: 300, type: \"general\" }, //[15]\n    { desc: \"150 warm up\", dist: 150, type: \"general\" }, //[19]\n];\n\n// Option for no warmup, as seen in some sources [1, 9]\nconst noWarmupOption = { desc: \"No warmup bitches\", dist: 0, type: \"none\" }; //[1]\n\nexport { warmups, noWarmupOption };\n","// Cool-down options based on various sources [2, 5, 7, 9, 10, 12, 13, 16, 17, 19-21]\nconst cooldowns = [\n    { desc: \"200 w fins (or combo)\", dist: 200, type: \"fins\" }, //[2]\n    { desc: \"200 swim cooldown\", dist: 200, type: \"swim\" }, //[5]\n    { desc: \"100 cool down\", dist: 100, type: \"general\" }, //[7]\n    { desc: \"300 CD\", dist: 300, type: \"general\" }, //[9]\n    { desc: \"200 CD\", dist: 200, type: \"general\" }, //[10, 16, 21]\n    { desc: \"450 cooldown (300 swim, 150 under)\", dist: 450, type: \"swim/under\" }, //[20]\n    { desc: \"100 cool\", dist: 100, type: \"general\" }, //[17]\n    { desc: \"150 cooldown and 20 minutes of stick skills\", dist: 150, type: \"general\" }, //[19]\n    { desc: \"100 fin swim cooldown\", dist: 100, type: \"fin swim\" }, //[12]\n    { desc: \"250 cool down\", dist: 250, type: \"general\" }, //[13]\n];\n\nexport { cooldowns };\n","// Content of lib/data/mainSets/ENDURANCE_BASE.js to be updated:\n\nexport const ENDURANCE_BASE = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    // New pace: CSS + 5-15 seconds\n    let targetPacePer100 = cssSecondsPer100 + 5 + (Math.random() * 10);\n\n    if (remainingDistanceForMainSet < 500) {\n        return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `EN1: Too short. Min rep distance 500, available: ${remainingDistanceForMainSet}.` };\n    }\n\n    const allPossibleRepDistances = [500, 600, 700, 800, 900, 1000];\n    let bestOption = { dist: 0, reps: 0, totalYardage: 0, is500: false };\n\n    for (const currentDist of allPossibleRepDistances) {\n        if (remainingDistanceForMainSet >= currentDist) {\n            let currentReps = Math.floor(remainingDistanceForMainSet / currentDist);\n            if (currentReps === 0) continue;\n\n            let maxRepsForCurrentDist;\n            if (currentDist === 500) maxRepsForCurrentDist = 12; // e.g. 12x500 is 6000\n            else if (currentDist === 600) maxRepsForCurrentDist = 10; // e.g. 10x600 is 6000\n            else if (currentDist === 700) maxRepsForCurrentDist = 8; // e.g. 8x700 is 5600\n            else if (currentDist === 800) maxRepsForCurrentDist = 7; // e.g. 7x800 is 5600\n            else if (currentDist === 900) maxRepsForCurrentDist = 6; // e.g. 6x900 is 5400\n            else if (currentDist === 1000) maxRepsForCurrentDist = 6; // e.g. 6x1000 is 6000\n\n            else maxRepsForCurrentDist = 1; // Should not happen with the defined list\n\n            currentReps = Math.min(currentReps, maxRepsForCurrentDist);\n\n            if (currentReps > 0) {\n                const currentTotalYardage = currentReps * currentDist;\n                const isCurrentDist500 = currentDist === 500;\n\n                if (currentTotalYardage > bestOption.totalYardage) {\n                    bestOption = { dist: currentDist, reps: currentReps, totalYardage: currentTotalYardage, is500: isCurrentDist500 };\n                } else if (currentTotalYardage === bestOption.totalYardage) {\n                    if (!bestOption.is500 && isCurrentDist500) { // Prefer 500s if yardage is same\n                        bestOption = { dist: currentDist, reps: currentReps, totalYardage: currentTotalYardage, is500: isCurrentDist500 };\n                    } else if (bestOption.is500 == isCurrentDist500 && currentReps > bestOption.reps) { // If 500-status is same, prefer more reps\n                        bestOption = { dist: currentDist, reps: currentReps, totalYardage: currentTotalYardage, is500: isCurrentDist500 };\n                    }\n                }\n            }\n        }\n    }\n\n    let en1RepDist = bestOption.dist;\n    let numEn1Reps = bestOption.reps;\n\n    if (numEn1Reps > 0 && en1RepDist > 0) {\n        // Fixed rest\n        let en1Rest = 'r60\"';\n        sets.push(`${numEn1Reps}x${en1RepDist} ${energySystem} focus swim/kick ${en1Rest}`);\n        mainSetTotalDist = numEn1Reps * en1RepDist;\n    } else {\n        // This case should ideally be minimal if remainingDistanceForMainSet >= 500\n        mainSetTotalDist = 0;\n    }\n\n    let descriptiveMessage;\n    if (mainSetTotalDist > 0) {\n         descriptiveMessage = `EN1: ${numEn1Reps}x${en1RepDist} (${energySystem}), CSS +5-15s/100m pace guide, 60\" rest.`;\n    } else if (remainingDistanceForMainSet < 500) { // Should be caught at the top\n        descriptiveMessage = `EN1: Too short. Min rep distance 500, available: ${remainingDistanceForMainSet}.`;\n    } else { // remainingDistanceForMainSet >= 500 but no suitable sets found (highly unlikely with the logic)\n        descriptiveMessage = `EN1: Could not fit EN1 reps for ${energySystem}. Available: ${remainingDistanceForMainSet}.`;\n    }\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage };\n};\n","export const THRESHOLD_SUSTAINED = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    // New pace: At CSS\n    let targetPacePer100 = cssSecondsPer100;\n\n    console.log('--- THRESHOLD_SUSTAINED ---');\n    console.log('remainingDistanceForMainSet:', remainingDistanceForMainSet);\n\n    const en2SetPatterns = [\n        // Ordered by a rough preference or commonality, can be adjusted\n        { id: '18x100', reps: 18, dist: 100, rest: 'r10\"', requiredDist: 18 * 100, paceDesc: 'CSS' },\n        { id: '10x200', reps: 10, dist: 200, rest: 'r20\"', requiredDist: 10 * 200, paceDesc: 'CSS' },\n\n        // For longer intervals, allow variable reps\n        { id: 'Nx400', baseDist: 400, rest: 'r40\"', maxReps: 18, paceDesc: 'CSS' }, \n        { id: 'Nx500', baseDist: 500, rest: 'r50\"', maxReps: 14, paceDesc: 'CSS' }, \n        { id: 'Nx600', baseDist: 600, rest: 'r60\"', maxReps: 12, paceDesc: 'CSS' }, \n        { id: 'Nx800', baseDist: 800, rest: 'r90\"', maxReps: 8, paceDesc: 'CSS' }, \n        { id: 'Nx1000', baseDist: 1000, rest: 'r90\"', maxReps: 6, paceDesc: 'CSS' } \n    ];\n    console.log('en2SetPatterns:', JSON.stringify(en2SetPatterns.map(p => p.id)));\n\n    let viablePatterns = [];\n\n    for (const pattern of en2SetPatterns) {\n        if (pattern.baseDist) { // For NxDist patterns\n            if (remainingDistanceForMainSet >= pattern.baseDist) {\n                let numReps = Math.floor(remainingDistanceForMainSet / pattern.baseDist);\n                numReps = Math.min(numReps, pattern.maxReps);\n                if (numReps > 0) {\n                    const currentSetTotalDist = numReps * pattern.baseDist;\n                    viablePatterns.push({\n                        reps: numReps,\n                        dist: pattern.baseDist,\n                        rest: pattern.rest,\n                        totalDist: currentSetTotalDist,\n                        paceDesc: pattern.paceDesc,\n                        id: `${numReps}x${pattern.baseDist}`\n                    });\n                }\n            }\n        } else { // For fixed rep x dist patterns\n            if (remainingDistanceForMainSet >= pattern.requiredDist) {\n                viablePatterns.push({\n                    reps: pattern.reps,\n                    dist: pattern.dist,\n                    rest: pattern.rest,\n                    totalDist: pattern.requiredDist,\n                    paceDesc: pattern.paceDesc,\n                    id: pattern.id\n                });\n            }\n        }\n    }\n    console.log('Viable patterns after filtering:', JSON.stringify(viablePatterns.map(p => p.id)));\n\n    let bestFitSet = null;\n    let selectionMethod = '';\n\n    if (viablePatterns.length > 0) {\n        if (viablePatterns.length === 1) {\n            bestFitSet = viablePatterns[0];\n            selectionMethod = 'Single viable pattern';\n        } else {\n            // Prioritize patterns that use more of the available distance\n            let maxDistance = 0;\n            viablePatterns.forEach(pattern => {\n                if (pattern.totalDist > maxDistance) {\n                    maxDistance = pattern.totalDist;\n                }\n            });\n            const bestDistancePatterns = viablePatterns.filter(p => p.totalDist === maxDistance);\n\n            if (bestDistancePatterns.length === 1) {\n                bestFitSet = bestDistancePatterns[0];\n                selectionMethod = 'Single best distance pattern';\n            } else {\n                // If multiple patterns achieve the same max distance, pick one randomly\n                const randomIndex = Math.floor(Math.random() * bestDistancePatterns.length);\n                bestFitSet = bestDistancePatterns[randomIndex];\n                selectionMethod = `Randomly selected from ${bestDistancePatterns.length} best distance patterns`;\n            }\n        }\n    } else {\n        selectionMethod = 'Fallback logic initiated';\n    // Fallback: if no specific pattern fits, try to construct a simpler set.\n    // E.g., if remaining is 1200, 18x100 (1800) is too much.\n    // Perhaps multiple shorter sets or a smaller version of one.\n    // The guidelines are specific about the set structures.\n    // If remainingDistanceForMainSet is too small for any of these, it produces no set.\n    // Let's try a simpler fallback: if less than the smallest full set (1800), try to do multiples of 100s or 200s at CSS.\n    if (!bestFitSet && remainingDistanceForMainSet >= 100) {\n        let fallbackDist = 0, fallbackReps = 0, fallbackRest = '', fallbackTotal = 0;\n\n        if (remainingDistanceForMainSet >= 200) { // Try 200s first\n            fallbackDist = 200;\n            fallbackReps = Math.min(Math.floor(remainingDistanceForMainSet / 200), 40); \n            fallbackRest = 'r20\"';\n            selectionMethod += ' -> Attempting fallback with 200s';\n        } else { // Must be 100s\n            fallbackDist = 100;\n            fallbackReps = Math.min(Math.floor(remainingDistanceForMainSet / 100), 60); \n            fallbackRest = 'r10\"';\n            selectionMethod += ' -> Attempting fallback with 100s';\n        }\n        if (fallbackReps > 0) {\n            fallbackTotal = fallbackReps * fallbackDist;\n            if (fallbackTotal > 0) { // Ensure it's a meaningful set\n                 bestFitSet = {\n                    reps: fallbackReps,\n                    dist: fallbackDist,\n                    rest: fallbackRest,\n                    totalDist: fallbackTotal,\n                    paceDesc: 'CSS',\n                    id: `${fallbackReps}x${fallbackDist} (fallback)`\n                };\n                selectionMethod += ` -> Selected fallback: ${bestFitSet.id}`;\n            } else {\n                selectionMethod += ' -> Fallback resulted in no meaningful set (totalDist <=0)';\n            }\n        } else {\n            selectionMethod += ' -> Fallback resulted in no meaningful set (fallbackReps <=0)';\n        }\n    } else {\n        if (bestFitSet) { // This case should ideally not be reached if !bestFitSet is the entry condition\n             selectionMethod += ' -> Fallback logic skipped (bestFitSet already found, unexpected)';\n        } else if (remainingDistanceForMainSet < 100) {\n            selectionMethod += ' -> Fallback logic skipped (remainingDistance < 100)';\n        } else {\n            selectionMethod += ' -> Fallback logic skipped (conditions not met, this is unexpected if viablePatterns was empty)';\n        }\n    }\n}\n\n    console.log('Pattern selection method:', selectionMethod);\n    console.log('Final bestFitSet:', bestFitSet ? JSON.stringify(bestFitSet) : 'null');\n\n    let descriptiveMessage;\n\n    if (bestFitSet) {\n        sets.push(`${bestFitSet.reps}x${bestFitSet.dist} ${energySystem} focus swim @ ${bestFitSet.paceDesc} ${bestFitSet.rest}`);\n        mainSetTotalDist = bestFitSet.totalDist;\n        descriptiveMessage = `EN2: ${bestFitSet.id} (${energySystem}) @ CSS.`;\n    } else {\n        mainSetTotalDist = 0;\n        if (remainingDistanceForMainSet < 100) {\n            descriptiveMessage = `EN2: Too short for EN2 sets. Available: ${remainingDistanceForMainSet}.`;\n        } else {\n            descriptiveMessage = `EN2: Could not fit standard EN2 set for ${energySystem}. Available: ${remainingDistanceForMainSet}.`;\n        }\n    }\n    console.log('Descriptive message:', descriptiveMessage);\n    console.log('--- END THRESHOLD_SUSTAINED ---');\n\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage };\n};\n","export const THRESHOLD_DEVELOPMENT = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    // New pace: CSS - 1 to 2 seconds\n    let targetPacePer100 = cssSecondsPer100 - 1 - Math.random(); // Results in css - 1.0 to css - 1.999...\n\n    const en3SetPatterns = [\n        // New Nx patterns for longer distancess\n        { idFormat: 'Nx400', baseDist: 400, rest: 'r50\"', maxReps: 18, paceDesc: 'CSS' }, \n        { idFormat: 'Nx500', baseDist: 500, rest: 'r60\"', maxReps: 14, paceDesc: 'CSS' }, \n        { idFormat: 'Nx600', baseDist: 600, rest: 'r90\"', maxReps: 12, paceDesc: 'CSS' }, \n    ];\n\n    let bestFitSet = null;\n    let maxAchievedDistance = 0;\n\n    for (const pattern of en3SetPatterns) {\n        if (pattern.baseDist) { // For NxDist patterns (800, 1000)\n            if (remainingDistanceForMainSet >= pattern.baseDist) {\n                let numReps = Math.floor(remainingDistanceForMainSet / pattern.baseDist);\n                numReps = Math.min(numReps, pattern.maxReps);\n                if (numReps > 0) {\n                    const currentSetTotalDist = numReps * pattern.baseDist;\n                    if (currentSetTotalDist > maxAchievedDistance) {\n                        maxAchievedDistance = currentSetTotalDist;\n                        bestFitSet = {\n                            reps: numReps,\n                            dist: pattern.baseDist,\n                            rest: pattern.rest,\n                            totalDist: currentSetTotalDist,\n                            paceDesc: pattern.paceDesc,\n                            id: `${numReps}x${pattern.baseDist}` // Dynamic ID\n                        };\n                    }\n                }\n            }\n        } else { // For fixed rep x dist patterns (4x600, 4x500, 4x400)\n            if (remainingDistanceForMainSet >= pattern.requiredDist) {\n                // If it fits and is larger than any previously found NxDist set\n                if (pattern.requiredDist > maxAchievedDistance) {\n                    maxAchievedDistance = pattern.requiredDist;\n                    bestFitSet = {\n                        reps: pattern.reps,\n                        dist: pattern.dist,\n                        rest: pattern.rest,\n                        totalDist: pattern.requiredDist,\n                        paceDesc: pattern.paceDesc,\n                        id: pattern.id // Fixed ID\n                    };\n                }\n            }\n        }\n    }\n\n    // Fallback logic: if remaining distance is less than the smallest fixed set (4x400=1600)\n    // but larger than the smallest single rep (400), try to make a smaller set.\n    // This prioritizes fitting any of the defined patterns first, even if they are large.\n    // If no pattern fits (e.g. remainingDistanceForMainSet is 1200), this fallback kicks in.\n    if (!bestFitSet && remainingDistanceForMainSet >= 400) {\n        const singleRepOptions = [ // Keep baseReps for fallback scaling, but try to fill remaining\n            { dist: 600, rest: 'r90\"', paceDesc: 'CSS -1-2s', baseReps: 4 },\n            { dist: 500, rest: 'r60\"', paceDesc: 'CSS -1-2s', baseReps: 4 },\n            { dist: 400, rest: 'r45\"', paceDesc: 'CSS -1-2s', baseReps: 4 }\n        ];\n\n        let bestFallbackOption = null;\n        let maxFallbackYardage = 0;\n\n        for (const option of singleRepOptions) {\n            if (remainingDistanceForMainSet >= option.dist) { // Must be able to do at least one rep\n                let numReps = Math.floor(remainingDistanceForMainSet / option.dist);\n                // For fallback, don't necessarily cap at baseReps, try to use up the distance\n                // but still keep it reasonable, e.g. not more than maxReps of new patterns if applicable\n                // For simplicity here, let's cap at a slightly higher number like 6-8 for fallback\n                numReps = Math.min(numReps, 6); // Example cap for fallback reps\n\n                if (numReps > 0) {\n                    const currentYardage = numReps * option.dist;\n                    if (currentYardage > maxFallbackYardage) {\n                        maxFallbackYardage = currentYardage;\n                        bestFallbackOption = {\n                            reps: numReps,\n                            dist: option.dist,\n                            rest: option.rest,\n                            totalDist: currentYardage,\n                            paceDesc: option.paceDesc,\n                            id: `${numReps}x${option.dist} (fallback)`\n                        };\n                    }\n                }\n            }\n        }\n        if (bestFallbackOption) {\n            bestFitSet = bestFallbackOption; // Use this fallback set\n        }\n    }\n\n    let descriptiveMessage;\n\n    if (bestFitSet) {\n        sets.push(`${bestFitSet.reps}x${bestFitSet.dist} ${energySystem} focus swim @ ${bestFitSet.paceDesc} ${bestFitSet.rest}`);\n        mainSetTotalDist = bestFitSet.totalDist; // Use totalDist from the chosen set object\n        descriptiveMessage = `EN3: ${bestFitSet.id} (${energySystem}) @ ${bestFitSet.paceDesc}.`;\n    } else {\n        mainSetTotalDist = 0;\n        const minReq = 400; // Smallest single rep distance for any consideration\n        if (remainingDistanceForMainSet < minReq) {\n            descriptiveMessage = `EN3: Too short for EN3 sets (min rep 400). Available: ${remainingDistanceForMainSet}.`;\n        } else {\n            descriptiveMessage = `EN3: Could not fit standard or fallback EN3 set for ${energySystem}. Available: ${remainingDistanceForMainSet}.`;\n        }\n    }\n\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage };\n};\n","// Content of lib/data/mainSets/SPEED_ENDURANCE.js to be updated:\n\nconst sp1RepDistances = [25, 50, 75, 100]; // Valid rep distances for SP1\nconst sp1Drills = [\"swim\", \"kb\", \"FU\", \"HUHO\"]; // FU = Fast Underwater, HUHO = Hypoxic Hips Out\n\n// Helper function to get SP1 rest based on rep distance\nconst getSp1Rest = (repDist) => {\n    let baseRestSeconds;\n    if (repDist === 100) baseRestSeconds = 10; // EN2 rest for 100s\n    else if (repDist === 75) baseRestSeconds = 7.5; // Proportional\n    else if (repDist === 50) baseRestSeconds = 5;   // Proportional\n    else if (repDist === 25) baseRestSeconds = 2.5; // Proportional\n    else baseRestSeconds = 5; // Default small rest\n\n    // Double or triple EN2 equivalent rest\n    const multiplier = 2 + Math.random(); // Randomly between 2x and 3x\n    let restSeconds = Math.round((baseRestSeconds * multiplier) / 5) * 5; // Round to nearest 5s\n    restSeconds = Math.max(restSeconds, 5); // Minimum 5s\n    if (repDist === 100) restSeconds = Math.max(restSeconds, 20); // Ensure 100s get at least 20s\n\n    return `r${restSeconds}\"`;\n};\n\nexport const SPEED_ENDURANCE = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    // New pace: CSS - 3 to 5 seconds\n    let targetPacePer100 = cssSecondsPer100 - 3 - (Math.random() * 2);\n\n    // SP1 overall set length: 400 to 800yd.\n    // We'll use remainingDistanceForMainSet, but cap it effectively for SP1's typical range.\n    const targetSp1TotalYardage = Math.max(400, Math.min(remainingDistanceForMainSet, 4500));\n\n    if (remainingDistanceForMainSet < sp1RepDistances[0]) { // Smallest rep is 25\n        return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `SP1: Too short. Min rep 25. Available: ${remainingDistanceForMainSet}.` };\n    }\n\n    if (targetSp1TotalYardage < sp1RepDistances[0]) {\n         return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `SP1: Target yardage too low. Available: ${remainingDistanceForMainSet}.` };\n    }\n\n    let numBlocks = Math.max(1, Math.ceil(targetSp1TotalYardage / 800)); // Dynamic blocks, avg ~800yd per block\n\n    let accumulatedDistInSp1Set = 0;\n    let actualRemainingForSp1Blocks = targetSp1TotalYardage;\n\n    for (let i = 0; i < numBlocks; i++) {\n        if (actualRemainingForSp1Blocks < sp1RepDistances[0]) break;\n\n        let distForCurrentBlock = Math.floor(actualRemainingForSp1Blocks / (numBlocks - i));\n        if (distForCurrentBlock < sp1RepDistances[0]) continue;\n\n        // Select rep distance for the block - try to use a mix, or pick one that fits well\n        let repDist = sp1RepDistances[Math.floor(Math.random() * sp1RepDistances.length)];\n\n        // Ensure repDist is not too large for distForCurrentBlock\n        if (repDist > distForCurrentBlock) {\n            const possibleDists = sp1RepDistances.filter(d => d <= distForCurrentBlock);\n            if (possibleDists.length > 0) {\n                repDist = possibleDists[possibleDists.length - 1]; // Largest possible that fits\n            } else {\n                continue; // No suitable repDist for this block's target distance\n            }\n        }\n        if (repDist === 0) continue;\n\n        let numReps = Math.floor(distForCurrentBlock / repDist);\n        numReps = Math.min(numReps, 16); // Cap reps per block (e.g. 16x25=400, 8x50=400, 4x100=400)\n        numReps = Math.max(numReps, 1); // Ensure at least one rep\n\n        if (numReps * repDist > distForCurrentBlock) { // Adjust if overshoot (should be rare)\n            numReps = Math.floor(distForCurrentBlock / repDist);\n        }\n\n        if (numReps > 0) {\n            const currentBlockActualYardage = numReps * repDist;\n            const sp1Rest = getSp1Rest(repDist);\n            const drillType = sp1Drills[Math.floor(Math.random() * sp1Drills.length)];\n\n            sets.push(`${numReps}x${repDist} ${drillType} (${energySystem} focus) ${sp1Rest}`);\n\n            accumulatedDistInSp1Set += currentBlockActualYardage;\n            actualRemainingForSp1Blocks -= currentBlockActualYardage;\n\n            if (i < numBlocks - 1 && actualRemainingForSp1Blocks >= sp1RepDistances[0]) {\n                // Rest between blocks: 1-2 minutes\n                const blockRestSeconds = 60 + Math.floor(Math.random() * 61); // 60 to 120 seconds\n                if (blockRestSeconds >= 60) {\n                     const minutes = Math.floor(blockRestSeconds / 60);\n                     const seconds = blockRestSeconds % 60;\n                     if (seconds === 0) sets.push(`${minutes}min rest between SP1 blocks`);\n                     else sets.push(`${minutes}min ${seconds}s rest between SP1 blocks`);\n                } else { // Should not happen with current logic\n                     sets.push(`${blockRestSeconds}s rest between SP1 blocks`);\n                }\n            }\n        }\n    }\n    mainSetTotalDist = accumulatedDistInSp1Set;\n\n    let descriptiveMessage;\n    if (mainSetTotalDist > 0) {\n        descriptiveMessage = `SP1: Lactate Tolerance (${energySystem}), CSS -3-5s. Total ~${mainSetTotalDist}yds.`;\n    } else {\n        descriptiveMessage = `SP1: Could not fit SP1 set. Available: ${remainingDistanceForMainSet}, Target SP1 range: 400-800.`;\n    }\n\n    // If mainSetTotalDist is very low compared to what was available (e.g. targetSp1TotalYardage was 400, but we only made 100)\n    // This might indicate the block division or rep selection was suboptimal.\n    // The current logic tries to fill targetSp1TotalYardage.\n\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage };\n};\n","// Content of lib/data/mainSets/MAX_SPRINT.js to be updated:\n\nconst sp2RepDistances = [25, 50];\n\n// Helper function to get SP2 rest string (e.g., \"1'30\"r\" or \"3'r\")\nconst getSp2RestString = (repDist) => {\n    let minSec, maxSec;\n    if (repDist === 25) {\n        minSec = 60; // 1 min\n        maxSec = 180; // 3 min\n    } else if (repDist === 50) {\n        minSec = 180; // 3 min\n        maxSec = 300; // 5 min\n    } else { // Should not happen\n        minSec = 60;\n        maxSec = 120;\n    }\n\n    const totalSeconds = minSec + Math.floor(Math.random() * (maxSec - minSec + 1));\n\n    const minutes = Math.floor(totalSeconds / 60);\n    const seconds = totalSeconds % 60;\n\n    let restString = \"\";\n    if (minutes > 0) {\n        restString += `${minutes}'`;\n    }\n    if (seconds > 0) {\n        // If there are minutes, and seconds, add a space or separator if needed,\n        // but standard notation often just concatenates e.g. 1'30\"\n        restString += `${seconds}\"`;\n    } else if (minutes === 0 && seconds === 0) { // Unlikely to be 0 total rest\n        restString = '10\"'; // Default small rest if somehow 0\n    }\n     if (minutes > 0 && seconds === 0) { // e.g. 3'\n        // No need to add 00\"\n    }\n    return `r${restString}`;\n};\n\n\nexport const MAX_SPRINT = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    // New pace: CSS -10 to -15s (near max)\n    let targetPacePer100 = cssSecondsPer100 - 10 - (Math.random() * 5);\n\n    // SP2 overall set length: 300 to 600yds.\n    const targetSp2TotalYardage = Math.max(300, Math.min(remainingDistanceForMainSet, 4500));\n\n    if (remainingDistanceForMainSet < sp2RepDistances[0]) { // Smallest rep is 25\n        return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `SP2: Too short. Min rep 25. Available: ${remainingDistanceForMainSet}.` };\n    }\n    if (targetSp2TotalYardage < sp2RepDistances[0]) {\n         return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `SP2: Target yardage ${targetSp2TotalYardage} too low. Min rep 25.` };\n    }\n\n    let repDist = 0;\n    let numReps = 0;\n\n    // Decide on rep distance: 25s or 50s.\n    // If targetSp2TotalYardage is small (e.g., < 150 for 50s), prefer 25s.\n    // Or, if it allows significantly more reps for 25s.\n    // Let's try to pick one and stick to it for the set.\n    // Prioritize 50s if enough yardage (e.g. >= 150-200), otherwise 25s.\n\n    const canDo50s = targetSp2TotalYardage >= 50; // Min 1 rep of 50\n    const canDo25s = targetSp2TotalYardage >= 25; // Min 1 rep of 25\n\n    if (canDo50s && targetSp2TotalYardage >= 150) { // Prefer 50s if total yardage is decent\n        repDist = 50;\n    } else if (canDo25s) {\n        repDist = 25;\n    } else { // Not enough for even a single 25\n         return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `SP2: Not enough yardage for a single rep. Target: ${targetSp2TotalYardage}.` };\n    }\n\n    numReps = Math.floor(targetSp2TotalYardage / repDist);\n    numReps = Math.max(numReps, 1); // Ensure at least 1 rep if we decided on a repDist\n\n    const actualSetTotalYardage = numReps * repDist;\n\n    if (actualSetTotalYardage > 0) {\n        const sp2Rest = getSp2RestString(repDist);\n        // Original set string: `${numReps}x${repDist} UW sprint (${energySystem} focus, breath at wall) @ ${sp2Rest}`\n        // Keeping similar style. \"UW sprint\" and \"breath at wall\" are good specifiers for max effort.\n        sets.push(`${numReps}x${repDist} UW sprint (${energySystem} focus, breath at wall) ${sp2Rest}`);\n        mainSetTotalDist = actualSetTotalYardage;\n    } else {\n        // This path should be less likely given the checks.\n        mainSetTotalDist = 0;\n    }\n\n    let descriptiveMessage;\n    if (mainSetTotalDist > 0) {\n        descriptiveMessage = `SP2: Lactate Production (${energySystem}), Near Max Effort. Set: ${numReps}x${repDist}. Total ~${mainSetTotalDist}yds.`;\n    } else {\n        descriptiveMessage = `SP2: Could not fit SP2 set. Available: ${remainingDistanceForMainSet}, Target SP2 range: 300-600.`;\n    }\n\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage };\n};\n","export const GENERAL_ENDURANCE = (energySystem, cssSecondsPer100, remainingDistanceForMainSet) => {\n    let sets = [];\n    let mainSetTotalDist = 0;\n    let targetPacePer100 = cssSecondsPer100;\n    const generalDistances = [500, 400, 300, 200, 100, 50];\n    let bestRepDist = 0;\n    let bestNumReps = 0;\n    let smallestRemainder = Infinity;\n\n    if (remainingDistanceForMainSet < 25) { // Smallest possible rep distance\n        return { sets, mainSetTotalDist: 0, targetPacePer100, descriptiveMessage: `General Endurance (${energySystem}) set - too short.` };\n    }\n\n    for (const dist of generalDistances) {\n        if (remainingDistanceForMainSet >= dist) {\n            let currentNumReps = Math.floor(remainingDistanceForMainSet / dist);\n            let currentRemainder = remainingDistanceForMainSet - (currentNumReps * dist);\n            if (currentNumReps > 0) { // Only consider if at least one rep is possible\n                if (currentRemainder < smallestRemainder) {\n                    smallestRemainder = currentRemainder;\n                    bestRepDist = dist;\n                    bestNumReps = currentNumReps;\n                } else if (currentRemainder === smallestRemainder) {\n                    if (dist > bestRepDist) { // Prefer larger rep distance for same remainder\n                        bestRepDist = dist;\n                        bestNumReps = currentNumReps;\n                    }\n                }\n            }\n        }\n    }\n\n    if (bestNumReps === 0 && remainingDistanceForMainSet >= 25) {\n        // If no standard dist fits (e.g. remaining 75), make one up\n        // Try to make it a multiple of 25 or 50.\n        if (remainingDistanceForMainSet >= 50) {\n             bestRepDist = Math.floor(remainingDistanceForMainSet / 50) * 50;\n             if(bestRepDist === 0) bestRepDist = 50; // if remaining is e.g. 70, floor(70/50)*50 = 50\n        } else { // remaining is 25 to 49\n             bestRepDist = 25;\n        }\n        if (bestRepDist > 0) bestNumReps = Math.floor(remainingDistanceForMainSet / bestRepDist);\n        if (bestNumReps * bestRepDist > remainingDistanceForMainSet) bestNumReps = 0; // safety\n    }\n\n    // --- Start of new conservative adjustment logic ---\n    if (bestNumReps > 0 && bestRepDist > 0) {\n        let calculatedDist = bestNumReps * bestRepDist;\n\n        if (calculatedDist > remainingDistanceForMainSet * 0.80 && bestRepDist >= 200 && bestNumReps > 2) {\n            console.log(`DEBUG GENERAL_ENDURANCE: Conservative adjustment. Original reps: ${bestNumReps}x${bestRepDist}. Reducing reps by 1.`);\n            bestNumReps--;\n        }\n    }\n    // --- End of new conservative adjustment logic ---\n\n    if (bestNumReps > 0 && bestRepDist > 0) { // Ensure still valid after potential decrement\n        let restTime = 30;\n        if (bestRepDist >= 300) restTime = 45;\n        else if (bestRepDist >= 200) restTime = 30;\n        else if (bestRepDist >= 100) restTime = 20;\n        else restTime = 15;\n        sets.push(`${bestNumReps}x${bestRepDist} swim (${energySystem} focus) r${restTime}\"`);\n        mainSetTotalDist = bestNumReps * bestRepDist;\n    } else {\n         mainSetTotalDist = 0;\n    }\n    return { sets, mainSetTotalDist, targetPacePer100, descriptiveMessage: `General Endurance (${energySystem}) default set.` };\n};\n","import { ENDURANCE_BASE } from './mainSets/ENDURANCE_BASE.js';\nimport { THRESHOLD_SUSTAINED } from './mainSets/THRESHOLD_SUSTAINED.js';\nimport { THRESHOLD_DEVELOPMENT } from './mainSets/THRESHOLD_DEVELOPMENT.js';\nimport { SPEED_ENDURANCE } from './mainSets/SPEED_ENDURANCE.js';\nimport { MAX_SPRINT } from './mainSets/MAX_SPRINT.js';\nimport { GENERAL_ENDURANCE } from './mainSets/GENERAL_ENDURANCE.js';\n\nconst mainSetDefinitions = {\n    'ENDURANCE_BASE': ENDURANCE_BASE,\n    'THRESHOLD_SUSTAINED': THRESHOLD_SUSTAINED,\n    'THRESHOLD_DEVELOPMENT': THRESHOLD_DEVELOPMENT,\n    'SPEED_ENDURANCE': SPEED_ENDURANCE,\n    'MAX_SPRINT': MAX_SPRINT,\n    'GENERAL_ENDURANCE': GENERAL_ENDURANCE\n};\n\nexport { mainSetDefinitions };\n","/**\n * Selects a warmup routine.\n * There's a 90% chance of selecting a warmup from the availableWarmups array,\n * and a 10% chance of selecting the noWarmupOption.\n *\n * @param {Array<Object>} availableWarmups - An array of warmup objects. Each object should have at least 'desc' and 'dist' properties.\n * @param {Object} noWarmupOption - An object representing the option of no warmup. Should have 'desc' and 'dist'.\n * @returns {Object} The selected warmup object.\n */\nfunction selectWarmup(availableWarmups, noWarmupOption) {\n    const useWarmup = Math.random() > 0.1; // 90% chance of including a warmup\n\n    if (useWarmup && availableWarmups && availableWarmups.length > 0) {\n        return availableWarmups[Math.floor(Math.random() * availableWarmups.length)];\n    } else {\n        return noWarmupOption;\n    }\n}\n\n/**\n * Selects a cooldown routine randomly from the available options.\n *\n * @param {Array<Object>} availableCooldowns - An array of cooldown objects. Each object should have at least 'desc' and 'dist' properties.\n * @returns {Object|null} The selected cooldown object, or null if no cooldowns are available or an error occurs.\n */\nfunction selectCooldown(availableCooldowns) {\n    if (availableCooldowns && availableCooldowns.length > 0) {\n        return availableCooldowns[Math.floor(Math.random() * availableCooldowns.length)];\n    }\n    return null; // Or return a default cooldown if preferred\n}\n\n/**\n * Generates the main set for a workout based on the energy system.\n *\n * @param {string} energySystem - The energy system focus (e.g., 'EN1', 'EN2').\n * @param {number} cssSecondsPer100 - Critical Swim Speed in seconds per 100 units.\n * @param {number} remainingDistanceForMainSet - The distance available for the main set.\n * @param {string} workoutType - The type of workout (e.g., 'THRESHOLD_SUSTAINED').\n * @param {string} energySystem - The energy system focus (e.g., 'EN1', 'EN2').\n * @param {number} cssSecondsPer100 - Critical Swim Speed in seconds per 100 units.\n * @param {number} remainingDistanceForMainSet - The distance available for the main set.\n * @param {Object} mainSetDefinitions - Object mapping workout types to generator functions.\n * @returns {{ sets: string[], mainSetTotalDist: number, targetPacePer100: number, descriptiveMessage?: string }}\n *           An object containing the sets, total distance of the main set, target pace,\n *           and an optional descriptive message for unknown or default systems.\n */\nfunction generateMainSet(workoutType, energySystem, cssSecondsPer100, remainingDistanceForMainSet, mainSetDefinitions) {\n    let generator = mainSetDefinitions[workoutType];\n    let messageFromOuterScope;\n\n    if (!generator) {\n        messageFromOuterScope = `Unknown workout type: ${workoutType}. Defaulting to general endurance.`;\n        generator = mainSetDefinitions['GENERAL_ENDURANCE'];\n    }\n\n    // The generator function now expects energySystem as its first param.\n    let mainSetOutput = generator(energySystem, cssSecondsPer100, remainingDistanceForMainSet);\n\n    // Fallback condition: if the selected generator (not GENERAL_ENDURANCE) produced a very small set\n    if (mainSetOutput.mainSetTotalDist < 100 && remainingDistanceForMainSet > 100 && workoutType !== 'GENERAL_ENDURANCE') {\n        let fallbackMessage = \"(Fallback to general endurance due to low generated distance for selected workout type).\";\n\n        const originalMessage = mainSetOutput.descriptiveMessage; // Message from the original, tiny set\n        mainSetOutput = mainSetDefinitions['GENERAL_ENDURANCE'](energySystem, cssSecondsPer100, remainingDistanceForMainSet); // Rerun with GENERAL_ENDURANCE\n\n        // Construct descriptive message for fallback\n        let finalFallbackMessage = fallbackMessage;\n        if (originalMessage) { // If the original (tiny) set had a message\n            finalFallbackMessage = originalMessage + \" \" + fallbackMessage;\n        } else if (mainSetOutput.descriptiveMessage) { // If GENERAL_ENDURANCE set has a message\n            finalFallbackMessage = fallbackMessage + \" \" + mainSetOutput.descriptiveMessage;\n        }\n        mainSetOutput.descriptiveMessage = finalFallbackMessage;\n    } else {\n        // No fallback, or it was a direct 'GENERAL_ENDURANCE' call.\n        // If messageFromOuterScope was set (i.e., unknown workout type), it takes precedence\n        // unless the generator provided its own more specific message.\n        if (messageFromOuterScope) {\n            if (!mainSetOutput.descriptiveMessage) {\n                mainSetOutput.descriptiveMessage = messageFromOuterScope;\n            } else {\n                // If generator (GENERAL_ENDURANCE in this case) set a message, and it was an unknown type,\n                // combine or prioritize. For now, \"Unknown type\" message is more specific to the situation.\n                mainSetOutput.descriptiveMessage = messageFromOuterScope + \" Original generator message: \" + mainSetOutput.descriptiveMessage;\n            }\n        } else if (workoutType === 'GENERAL_ENDURANCE' && !mainSetOutput.descriptiveMessage) {\n            // If it was a direct 'GENERAL_ENDURANCE' call and the generator provided no message (unlikely with current data)\n            mainSetOutput.descriptiveMessage = `General Endurance (${energySystem}) set.`;\n        }\n    }\n    return mainSetOutput;\n}\n\nconst workoutFunctions = {\n    selectWarmup,\n    selectCooldown,\n    generateMainSet\n};\n\nexport default workoutFunctions;\n","import { warmups, noWarmupOption } from './data/warmups.js';\nimport { cooldowns } from './data/cooldowns.js';\nimport { mainSetDefinitions } from './data/mainSets.js';\nimport workoutComponents from './workoutComponents.js';\n\n// Helper function to convert MM:SS time string to total seconds per 100 units\nexport function parseCssTimeToSeconds(cssTimeStr) {\n    if (typeof cssTimeStr !== 'string') {\n        return null;\n    }\n    const parts = cssTimeStr.split(':');\n    if (parts.length === 2) {\n        const minutes = parseInt(parts[0], 10);\n        const seconds = parseFloat(parts[1]);\n        if (isNaN(minutes) || isNaN(seconds)) {\n            return null;\n        }\n        return minutes * 60 + seconds;\n    }\n    return null; // Invalid format\n}\n\n// Helper function to format total seconds per 100 units back to MM:SS\nexport function formatSecondsToMmSs(totalSeconds) {\n    const minutes = Math.floor(totalSeconds / 60);\n    const seconds = (totalSeconds % 60).toFixed(1); // One decimal for seconds\n    return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;\n}\n\n/**\n * Generates a random workout based on distance, energy system, and CSS time.\n * @param {number} totalDistanceYards - The approximate total desired workout distance in yards.\n * @param {string} energySystem - The energy system focus (e.g., 'EN1', 'EN2', 'EN3', 'SP1', 'SP2').\n * @param {string} cssTimeMmSs - The Critical Swim Speed in MM:SS format (e.g., '1:10').\n * @param {string} workoutType - The type of workout (e.g., 'threshold', 'anaerobic').\n * @returns {string} A formatted string describing the generated workout.\n */\nfunction generateWorkout(totalDistanceYards, energySystem, cssTimeMmSs, workoutType) {\n    const VERY_SHORT_WORKOUT_THRESHOLD = 600; // yards\n    // noWarmupOption is imported and can be used directly or cloned if description needs change for this specific case\n    // const noWarmupForShortOption = { ...noWarmupOption, desc: \"No warmup (short workout)\" };\n\n    const cssSecondsPer100 = parseCssTimeToSeconds(cssTimeMmSs);\n    if (cssSecondsPer100 === null) {\n        return \"Error: Invalid CSS time format. Please use MM:SS (e.g., '1:10').\";\n    }\n\n    let workoutDetails = [];\n    let currentDistanceCovered = 0;\n    const mainSetUnits = \"yards\"; // Assuming SCY based on sources unless specified otherwise [7, 9, 16]\n\n    // --- 1. Warmup Selection ---\n    let selectedWarmup;\n    if (totalDistanceYards < VERY_SHORT_WORKOUT_THRESHOLD) {\n        selectedWarmup = { ...noWarmupOption, desc: \"No warmup (short workout)\" };\n    } else {\n        // Re-introducing adaptive warmup logic for non-very-short workouts, with the specified modification\n        selectedWarmup = workoutComponents.selectWarmup(warmups, noWarmupOption); // Initial selection\n        if (selectedWarmup && selectedWarmup.dist > 0) {\n            const minMainSetThreshold = 200;\n            let maxAllowedWarmupDist = totalDistanceYards - minMainSetThreshold;\n\n            // Apply the more stringent percentage cap: 0.4 (40%) instead of 0.6\n            maxAllowedWarmupDist = Math.min(maxAllowedWarmupDist, totalDistanceYards * 0.4);\n\n            if (maxAllowedWarmupDist < 0 && totalDistanceYards > 0) {\n                 maxAllowedWarmupDist = totalDistanceYards * 0.4; // Fallback for small total distances if threshold makes it negative\n                                                                  // This 0.4 is different from the one above.\n                                                                  // Let's keep it as it was for this specific fallback:\n                 // maxAllowedWarmupDist = totalDistanceYards * 0.4; // This logic was for very small total distances\n                 // The logic from file before reset was:\n                 // if (maxAllowedWarmupDist < 0 && totalDistanceYards > 0) { maxAllowedWarmupDist = totalDistanceYards * 0.4; }\n                 // This specific 0.4 should remain if it's for the negative guard, distinct from the primary cap.\n                 // Re-evaluating based on typical structure: the primary cap (now 0.4) applies first.\n                 // Then, specific conditions for very small distances adjust if it results in negative or too small.\n                 // The previous adaptive logic was:\n                 // maxAllowedWarmupDist = Math.min(maxAllowedWarmupDist, totalDistanceYards * 0.6); // This is now 0.4\n                 // if (maxAllowedWarmupDist < 0 && totalDistanceYards > 0) { maxAllowedWarmupDist = totalDistanceYards * 0.4; }\n                 // The above line (totalDistanceYards * 0.4) was a fallback if the (totalDistanceYards - minMainSetThreshold) was negative.\n                 // It seems the logic should be:\n                 // 1. max = total - threshold\n                 // 2. max = min(max, total * NEW_PRIMARY_CAP (0.4))\n                 // 3. if max < 0 (because total was small), max = total * FALLBACK_CAP_FOR_SMALL_TOTAL (e.g. 0.4 or 0.5)\n                 // 4. if max < 50 (and total >=50), max = 50.\n                 // Let's stick to the prompt's direct change on the percentage line first.\n                 // The other parts of the adaptive logic are:\n            } // End of the \"maxAllowedWarmupDist < 0\" check\n\n            if (maxAllowedWarmupDist < 50 && totalDistanceYards >= 50) {\n                 maxAllowedWarmupDist = 50;\n            }\n            // Add a final guard if maxAllowedWarmupDist somehow ended up negative (e.g. if totalDistanceYards was < 50 but > 0)\n            if (maxAllowedWarmupDist < 0) maxAllowedWarmupDist = 0;\n\n\n            if (selectedWarmup.dist > maxAllowedWarmupDist) {\n                const suitableWarmups = warmups.filter(wu => wu.dist <= maxAllowedWarmupDist && wu.dist > 0);\n                if (suitableWarmups.length > 0) {\n                    selectedWarmup = suitableWarmups[Math.floor(Math.random() * suitableWarmups.length)];\n                } else {\n                    selectedWarmup = noWarmupOption;\n                }\n            }\n        } else if (!selectedWarmup || selectedWarmup.dist === 0) {\n            selectedWarmup = noWarmupOption;\n        }\n    }\n\n    if (selectedWarmup) {\n        workoutDetails.push(`WU: ${selectedWarmup.desc}`);\n        currentDistanceCovered += selectedWarmup.dist;\n    }\n\n    // --- 2. Main Set Generation ---\n    let mainSetDescription = \"Main Set:\";\n    let sets = [];\n    let mainSetTotalDist = 0;\n    let targetPacePer100;\n    let remainingDistanceForMainSet = totalDistanceYards - currentDistanceCovered;\n\n// Map energySystem to workoutType keys\nconst energySystemToWorkoutType = {\n    'EN1': 'ENDURANCE_BASE',\n    'EN2': 'THRESHOLD_SUSTAINED',\n    'EN3': 'THRESHOLD_DEVELOPMENT',\n    'SP1': 'SPEED_ENDURANCE',\n    'SP2': 'MAX_SPRINT',\n    // Add other mappings if necessary, or a default\n};\n\nlet internalWorkoutType = energySystemToWorkoutType[energySystem.toUpperCase()];\n\nif (!internalWorkoutType) {\n    console.warn(`Unknown energySystem: ${energySystem}. Defaulting to GENERAL_ENDURANCE if workoutType param is also not specific.`);\n    // If the original workoutType parameter was provided and is valid, it could be used.\n    // However, the new guidelines are driven by EN1, EN2 etc.\n    // So, if energySystem doesn't map, we might default or rely on the generateMainSet's default.\n    // For now, if energySystem doesn't map, internalWorkoutType will be undefined,\n    // and generateMainSet will default to GENERAL_ENDURANCE.\n    // The original 'workoutType' parameter from generateWorkout's signature is still available if needed as a fallback here.\n    // Let's make it explicit: if energySystem mapping fails, use the passed 'workoutType' parameter.\n    // If that is also undefined, generateMainSet handles the GENERAL_ENDURANCE default.\n    if (workoutType) { // workoutType is the original parameter of generateWorkout\n        internalWorkoutType = workoutType;\n    }\n    // If internalWorkoutType is still undefined, generateMainSet's default to GENERAL_ENDURANCE will occur.\n}\n\n\n// const mainSetResult = workoutComponents.generateMainSet(workoutType, energySystem, cssSecondsPer100, remainingDistanceForMainSet, mainSetDefinitions);\n// Replace with:\nconst mainSetResult = workoutComponents.generateMainSet(internalWorkoutType, energySystem, cssSecondsPer100, remainingDistanceForMainSet, mainSetDefinitions);\n    sets = mainSetResult.sets;\n    mainSetTotalDist = mainSetResult.mainSetTotalDist;\n    targetPacePer100 = mainSetResult.targetPacePer100;\n\n    if (mainSetResult.descriptiveMessage) {\n        mainSetDescription += ` ${mainSetResult.descriptiveMessage}`;\n    }\n\n    workoutDetails.push(mainSetDescription);\n    sets.forEach(set => {\n        workoutDetails.push(`  - ${set}`);\n    });\n    currentDistanceCovered += mainSetTotalDist;\n\n    // --- 3. Cool-down Selection ---\n    let selectedCooldown;\n    const noCooldownForShortOption = { desc: \"No cooldown (short workout)\", dist: 0, type: \"none\" };\n\n    if (totalDistanceYards < VERY_SHORT_WORKOUT_THRESHOLD) {\n        selectedCooldown = noCooldownForShortOption;\n    } else {\n        // Re-introducing adaptive cooldown logic with the specified modification\n        const generalNoCooldownOption = { desc: \"No cooldown\", dist: 0, type: \"none\" }; // General purpose\n        const distanceAfterMainSet = currentDistanceCovered;\n        const distanceToTarget = totalDistanceYards - distanceAfterMainSet;\n\n        if (distanceAfterMainSet >= totalDistanceYards - 50) {\n            selectedCooldown = generalNoCooldownOption;\n        } else {\n            // Apply the more stringent buffer: 25 instead of 75\n            const suitableCooldowns = cooldowns.filter(cd => cd.dist <= distanceToTarget + 25);\n\n            if (suitableCooldowns.length > 0) {\n                selectedCooldown = suitableCooldowns[Math.floor(Math.random() * suitableCooldowns.length)];\n            } else {\n                selectedCooldown = generalNoCooldownOption;\n            }\n        }\n    }\n\n    if (selectedCooldown) {\n        workoutDetails.push(`CD: ${selectedCooldown.desc}`);\n        currentDistanceCovered += selectedCooldown.dist;\n    }\n\n    // --- 4. Final Details ---\n    workoutDetails.push(`\\nTotal estimated distance: ${currentDistanceCovered} ${mainSetUnits}`);\n    workoutDetails.push(`CSS: ${cssTimeMmSs}`);\n    workoutDetails.push(`Workout Type: ${workoutType}`); // Added Workout Type\n    workoutDetails.push(`Energy System Focus: ${energySystem.toUpperCase()}`);\n    // A rough estimate of average pace, as true average depends on actual interval times and rest\n    workoutDetails.push(`Estimated AVG pace for main set: ${formatSecondsToMmSs(targetPacePer100)} / 100 ${mainSetUnits}`);\n\n    return workoutDetails.join('\\n');\n}\n\nexport { generateWorkout }; // Keep generateWorkout exported as it's likely the main API\n\n// --- Example Usage ---\n// console.log(generateWorkout(3000, 'EN3', '1:20'));\n// console.log(generateWorkout(2000, 'SP1', '1:10'));\n// console.log(generateWorkout(1500, 'SP2', '1:15'));\n// console.log(generateWorkout(2500, 'EN2', '1:12'));\n// console.log(generateWorkout(1800, 'EN1', '1:25'));","import _ from 'lodash';\n\nexport function getThingViaTimeLimit(key, secondsLeft, things, number = 1) {\n  let filteredThings = _.filter(things, thing => (thing[key] * number) <= secondsLeft);\n  return _.sample(filteredThings);\n}\n","import _ from 'lodash';\nimport {getThingViaTimeLimit} from './getThingViaTimeLimit';\nimport swims from './data/swims.json';\n\nexport function repeatIntervals(secondsLeft, generatedPattern) {\n  if (secondsLeft < 20) {\n    // console.log(`weird amount of time left: ${secondsLeft}. returning original pattern`);\n    return generatedPattern;\n  }\n\n  // console.log('repeatIntervals');\n\n  let seconds = 0;\n  let selectedSwim = getThingViaTimeLimit(\"time\", secondsLeft, swims);\n\n  // console.log(`repeating interval of type ${selectedSwim.name}`)\n\n  while (seconds + selectedSwim.time <= secondsLeft) {\n    let timeLeft = secondsLeft - seconds;\n    let maxRepetition = Math.floor(timeLeft / selectedSwim.time);\n\n    // attempt to keep max length 200 or less\n    maxRepetition = (maxRepetition * selectedSwim.interval) > 40 ?\n      Math.floor(40 / selectedSwim.interval) :\n      maxRepetition;\n\n    let intervalLength = _.random(1, maxRepetition);\n    let secondsToAdd = selectedSwim.time * intervalLength;\n\n    // console.log('adding swim', selectedSwim);\n\n    seconds += secondsToAdd;\n    generatedPattern.seconds += secondsToAdd;\n    generatedPattern.intervals.push(\n      {\n        type: selectedSwim.name,\n        length: selectedSwim.interval * 25 * intervalLength,\n        number: 1,\n        time: secondsToAdd\n      }\n    );\n  }\n\n  return generatedPattern;\n}\n","import _ from 'lodash';\nimport swims from './data/swims.json';\n\nfunction getSwimByLength(secondsLeft, intervalLength, number) {\n  if (secondsLeft < 20 * number) {\n    // console.log(`weird amount of time left: ${secondsLeft}. returning null`);\n    return null;\n  }\n\n  let selectSwim;\n  let numThings = 0;\n\n  let filteredSwims = _.cloneDeep(swims);\n\n  while (!selectSwim) {\n    numThings++;\n    selectSwim = _.sample(filteredSwims);\n\n    if ((selectSwim.time * number) > secondsLeft) {\n      // console.log(`swim too long ${selectSwim.time} ${number} ${secondsLeft}`);\n      filteredSwims = _.filter(filteredSwims, swim => swim.time < selectSwim.time);\n      selectSwim = null;\n    } else if ((selectSwim.interval > intervalLength) || (intervalLength % selectSwim.interval !== 0)) {\n      // console.log(`interval too long ${selectSwim.interval} ${intervalLength}`);\n      filteredSwims = _.filter(filteredSwims, swim => swim.interval < selectSwim.interval);\n      selectSwim = null;\n    }\n\n    if (numThings > 20) {throw new Error(`fuck ${secondsLeft} ${intervalLength} ${number}`);}\n  }\n\n  return selectSwim;\n}\n\nfunction createSwimGroupCount(selectedPattern) {\n  return _.reduce(selectedPattern.pattern, (result, set) => {\n    let swimLength = set.interval[1];\n\n    if(!result[set.group]) {\n      result[set.group] = { number: 1, intervalLength: swimLength}\n    } else {\n      result[set.group].number += 1;\n      result[set.group].intervalLength = _.min([result[set.group].intervalLength, swimLength]);\n    }\n\n    return result;\n  }, {});\n}\n\nfunction mapSwimGroupsToSwims(secondsLeft, selectedPattern, groupsWithCount) {\n  let groupsWithSwim = {};\n\n  let sets = selectedPattern.pattern.length;\n\n  // Find a swim which will fit the pattern and the time remaining\n  _.forEach(groupsWithCount, (groupSize, key) => {\n    let intervalSize = selectedPattern.intervalSize;\n    let otherSetTimes = (sets - groupSize.number) * intervalSize * 20;\n    let selectedSwim = getSwimByLength(\n      secondsLeft - otherSetTimes,\n      groupSize.intervalLength,\n      groupSize.number * intervalSize\n    );\n\n    groupsWithSwim[key] = selectedSwim;\n  });\n\n  return groupsWithSwim;\n}\n\nexport function createSwimsFromPattern(secondsLeft, generatedPattern, selectedPattern) {\n  if (secondsLeft < 20) {\n    // console.log(`weird amount of time left: ${secondsLeft}. returning original pattern`);\n    return generatedPattern;\n  }\n\n  let groupsWithCount = createSwimGroupCount(selectedPattern);\n  let groupsWithSwim = mapSwimGroupsToSwims(secondsLeft, selectedPattern, groupsWithCount);\n\n  // once we've figured out which swims go where, generate the intervals\n  _.forEach(selectedPattern.pattern, pattern => {\n    let selectedSwim = groupsWithSwim[pattern.group];\n    let numIntervals = pattern.interval[0];\n    let swimLength = pattern.interval[1];\n\n    // Some swims are > 1 lap\n    let intervalMultiplier = swimLength / selectedSwim.interval;\n    let totalSwimTime = selectedSwim.time * numIntervals * (intervalMultiplier);\n\n    generatedPattern.seconds += totalSwimTime;\n    generatedPattern.intervals.push(\n      {\n        type: selectedSwim.name,\n        length: swimLength * 25,\n        number: numIntervals,\n        time: selectedSwim.time * intervalMultiplier\n      }\n    );\n  });\n\n  return generatedPattern;\n}\n","import _ from 'lodash';\nimport patterns from './data/patterns.json';\nimport { generateWorkout as generateCssWorkout } from './css.js';\nimport {getThingViaTimeLimit} from './getThingViaTimeLimit';\nimport {repeatIntervals} from './repeatIntervals';\nimport {createSwimsFromPattern} from './createPattern';\n\nfunction isSameType(intervalA, intervalB) {\n  return intervalA.type === intervalB.type\n    && intervalA.length === intervalB.length\n    && intervalA.time === intervalB.time;\n}\n\nfunction doubleLengths(pattern) {\n  // console.log('doubleLengths');\n  pattern.seconds *= 2;\n\n  _.forEach(pattern.intervals, interval => {\n    interval.length *= 2;\n    interval.time *= 2;\n  });\n}\n\nfunction doubleIntervals(pattern) {\n  // console.log('doubleIntervals');\n  pattern.seconds *= 2;\n\n  _.forEach(pattern.intervals, interval => {\n    interval.number *= 2;\n  });\n}\n\nfunction condenseWorkout(pattern) {\n  pattern.intervals = pattern.intervals.reduce((memo, interval) => {\n    let intervalsLength = memo.length;\n\n    if(intervalsLength === 0) {\n      memo.push(interval);\n      return memo;\n    }\n\n    if (isSameType(memo[intervalsLength -1], interval)) {\n      // console.log('condensing', memo[intervalsLength - 1], interval);\n      memo[intervalsLength - 1].number += interval.number;\n    } else {\n      memo.push(interval)\n    }\n\n    return memo;\n  }, []);\n\n  // console.log(pattern);\n\n  return pattern;\n}\n\nexport { generateCssWorkout };\n\nexport function generatePattern(seconds, generatedPattern = { seconds: 0, intervals: [] }) {\n  if (seconds < 20) {\n    // console.log(`weird amount of time left: ${seconds}. returning generated pattern`);\n    return generatedPattern;\n  }\n\n  // console.log('generatePattern');\n\n  let timeLeft = seconds - generatedPattern.seconds;\n  let selectedPattern = getThingViaTimeLimit(\"minTime\", timeLeft, patterns);\n\n  // console.log(`attempting to generate ${selectedPattern.name} pattern, which needs ${selectedPattern.minTime}, and has ${timeLeft}`)\n\n  if (selectedPattern.repeat === true) {\n    return repeatIntervals(timeLeft, generatedPattern);\n  } else {\n    return createSwimsFromPattern(timeLeft, generatedPattern, selectedPattern);\n  }\n}\n\nexport function generateWorkout(seconds) {\n  if (!seconds) { throw new Error('Give me time!'); }\n\n  let pattern = generatePattern(seconds);\n\n  while ((pattern.seconds < (seconds / 2)) && (pattern.seconds >= 20)) {\n    switch(_.random(1,3)) {\n      case 1:\n        doubleLengths(pattern);\n        break;\n      case 2:\n        doubleIntervals(pattern);\n        break;\n      case 3:\n        // add new workout to pattern\n        generatePattern(seconds, pattern);\n        break;\n    }\n  }\n\n  while (seconds - pattern.seconds >= 20) {\n    generatePattern(seconds, pattern);\n  }\n\n  pattern = condenseWorkout(pattern);\n\n  return pattern;\n}\n"],"names":["warmups","desc","dist","type","noWarmupOption","cooldowns","ENDURANCE_BASE","energySystem","cssSecondsPer100","remainingDistanceForMainSet","sets","mainSetTotalDist","targetPacePer100","Math","random","descriptiveMessage","concat","allPossibleRepDistances","bestOption","reps","totalYardage","is500","_i","_allPossibleRepDistan","length","currentDist","currentReps","floor","maxRepsForCurrentDist","min","currentTotalYardage","isCurrentDist500","en1RepDist","numEn1Reps","en1Rest","push","THRESHOLD_SUSTAINED","console","log","en2SetPatterns","id","rest","requiredDist","paceDesc","baseDist","maxReps","JSON","stringify","map","p","viablePatterns","_en2SetPatterns","pattern","numReps","currentSetTotalDist","totalDist","bestFitSet","selectionMethod","maxDistance","forEach","bestDistancePatterns","filter","randomIndex","fallbackDist","fallbackReps","fallbackRest","fallbackTotal","THRESHOLD_DEVELOPMENT","en3SetPatterns","idFormat","maxAchievedDistance","_en3SetPatterns","singleRepOptions","baseReps","bestFallbackOption","maxFallbackYardage","_i2","_singleRepOptions","option","currentYardage","minReq","sp1RepDistances","sp1Drills","getSp1Rest","repDist","baseRestSeconds","multiplier","restSeconds","round","max","SPEED_ENDURANCE","targetSp1TotalYardage","numBlocks","ceil","accumulatedDistInSp1Set","actualRemainingForSp1Blocks","_loop","distForCurrentBlock","i","possibleDists","d","currentBlockActualYardage","sp1Rest","drillType","blockRestSeconds","minutes","seconds","_ret","sp2RepDistances","getSp2RestString","minSec","maxSec","totalSeconds","restString","MAX_SPRINT","targetSp2TotalYardage","canDo50s","canDo25s","actualSetTotalYardage","sp2Rest","GENERAL_ENDURANCE","generalDistances","bestRepDist","bestNumReps","smallestRemainder","Infinity","_generalDistances","currentNumReps","currentRemainder","calculatedDist","restTime","mainSetDefinitions","selectWarmup","availableWarmups","useWarmup","selectCooldown","availableCooldowns","generateMainSet","workoutType","generator","messageFromOuterScope","mainSetOutput","fallbackMessage","originalMessage","finalFallbackMessage","workoutFunctions","parseCssTimeToSeconds","cssTimeStr","parts","split","parseInt","parseFloat","isNaN","formatSecondsToMmSs","toFixed","generateWorkout","totalDistanceYards","cssTimeMmSs","VERY_SHORT_WORKOUT_THRESHOLD","workoutDetails","currentDistanceCovered","mainSetUnits","selectedWarmup","_objectSpread","workoutComponents","minMainSetThreshold","maxAllowedWarmupDist","suitableWarmups","wu","mainSetDescription","energySystemToWorkoutType","internalWorkoutType","toUpperCase","warn","mainSetResult","set","selectedCooldown","noCooldownForShortOption","generalNoCooldownOption","distanceAfterMainSet","distanceToTarget","suitableCooldowns","cd","join","getThingViaTimeLimit","key","secondsLeft","things","number","arguments","undefined","filteredThings","_","thing","sample","repeatIntervals","generatedPattern","selectedSwim","swims","time","timeLeft","maxRepetition","interval","intervalLength","secondsToAdd","intervals","name","getSwimByLength","selectSwim","numThings","filteredSwims","cloneDeep","swim","Error","createSwimGroupCount","selectedPattern","reduce","result","swimLength","group","mapSwimGroupsToSwims","groupsWithCount","groupsWithSwim","groupSize","intervalSize","otherSetTimes","createSwimsFromPattern","numIntervals","intervalMultiplier","totalSwimTime","isSameType","intervalA","intervalB","doubleLengths","doubleIntervals","condenseWorkout","memo","intervalsLength","generatePattern","patterns","repeat"],"mappings":"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"}